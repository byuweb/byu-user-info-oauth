{"version":3,"file":"byu-user-info-oauth.nomodule.js","sources":["../node_modules/@byuweb/browser-oauth/byu-browser-oauth.js","../byu-user-info-oauth.js"],"sourcesContent":["/*\n * Copyright 2018 Brigham Young University\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const STATE_CHANGE_EVENT = `${EVENT_PREFIX}-state-changed`;\nexport const LOGIN_REQUESTED_EVENT = `${EVENT_PREFIX}-login-requested`;\nexport const LOGOUT_REQUESTED_EVENT = `${EVENT_PREFIX}-logout-requested`;\nexport const REFRESH_REQUESTED_EVENT = `${EVENT_PREFIX}-refresh-requested`;\nexport const STATE_REQUESTED_EVENT = `${EVENT_PREFIX}-state-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n\nlet store = {state: STATE_INDETERMINATE};\n\nlet observer = onStateChange(detail => {\n    store = detail;\n});\n\nexport function onStateChange(callback) {\n    const func = function(e) {\n        callback(e.detail);\n    };\n    document.addEventListener(STATE_CHANGE_EVENT, func, false);\n    if (store.state === STATE_INDETERMINATE) {\n        dispatch(STATE_REQUESTED_EVENT, {callback});\n    } else {\n        callback(store);\n    }\n    return {\n        offStateChange: function() {\n            document.removeEventListener(STATE_CHANGE_EVENT, func, false);\n        }\n    }\n}\n\nexport function state() {\n    return store.state;\n}\n\nexport function hasToken() {\n    return !!store.token;\n}\n\nexport function token() {\n    return store.token;\n}\n\nexport function authorizationHeader() {\n    return store.token && store.token.authorizationHeader;\n}\n\nexport function user() {\n    return store.user;\n}\n\nexport function login() {\n    const promise = promiseState([STATE_AUTHENTICATED])\n    dispatch(LOGIN_REQUESTED_EVENT);\n    return promise;\n}\n\nexport function logout() {\n    const promise = promiseState([STATE_UNAUTHENTICATED]);\n    dispatch(LOGOUT_REQUESTED_EVENT);\n    return promise;\n}\n\nexport function refresh() {\n    const promise = promiseState([STATE_AUTHENTICATED, STATE_UNAUTHENTICATED]);\n    dispatch(REFRESH_REQUESTED_EVENT);\n    return promise;\n}\n\nexport function teardown() {\n    observer.offStateChange();\n    store = {state: STATE_INDETERMINATE};\n}\n\nfunction promiseState(desiredStates) {\n    if (!window.Promise) {\n        return null;\n    }\n    return new Promise((resolve, reject) => {\n        const observer = onStateChange(({state, token, user, error}) => {\n            if (error) {\n                reject(error);\n                observer.offStateChange();\n            } else if (desiredStates.indexOf(state) >= 0) {\n                resolve({state, token, user});\n                observer.offStateChange();\n            }\n        });\n    });\n}\n\nfunction dispatch(name, detail) {\n    let event;\n    if (typeof window.CustomEvent === 'function') {\n        event = new CustomEvent(name, {detail});\n    } else {\n        event = document.createEvent('CustomEvent');\n        event.initCustomEvent(name, true, false, detail);\n    }\n    document.dispatchEvent(event);\n}\n\n","/*\n * Copyright 2018 Brigham Young University\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as authn from './node_modules/@byuweb/browser-oauth/byu-browser-oauth.js';\n\nexport default class ByuUserInfoOAuth extends HTMLElement {\n    constructor() {\n        super();\n    }\n\n    connectedCallback() {\n        renderEmpty(this);\n        this._observer = authn.onStateChange(e => this.authStateChanged(e));\n    }\n\n    disconnectedCallback() {\n        if (this._observer) {\n            this._observer.offStateChange();\n        }\n        this._userInfo = null;\n    }\n\n    authStateChanged({state, token, user, error}) {\n        const userElement = this._userInfo.querySelector('[slot=\"user-name\"]');\n        const hasUserElement = !!userElement;\n        if (user) {\n            const el = hasUserElement ? userElement : this.ownerDocument.createElement('span');\n            el.setAttribute('slot', 'user-name');\n            el.innerText = user.name.givenName;\n\n            if (!hasUserElement) {\n                this._userInfo.appendChild(el);\n            }\n        } else if (hasUserElement) {\n            this._userInfo.removeChild(userElement);\n        }\n        //TODO: Handle error cases\n    }\n}\n\nwindow.customElements.define('byu-user-info-oauth', ByuUserInfoOAuth);\n\nfunction renderEmpty(el) {\n    const doc = el.ownerDocument;\n\n    const userInfo = doc.createElement('byu-user-info');\n\n    el._userInfo = userInfo;\n\n    const signIn = doc.createElement('a');\n    signIn.innerText = 'Sign In';\n    signIn.setAttribute('slot', 'login');\n    signIn.addEventListener('click', () => {\n        authn.login();\n    });\n\n    const signOut = doc.createElement('a');\n    signOut.innerText = 'Sign Out';\n    signOut.setAttribute('slot', 'logout');\n    signOut.addEventListener('click', () => {\n        authn.logout();\n    });\n\n    userInfo.appendChild(signIn);\n    userInfo.appendChild(signOut);\n\n    el.appendChild(userInfo);\n}\n"],"names":["const","let","super","authn.onStateChange","this","user","authn.login","authn.logout"],"mappings":"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"}