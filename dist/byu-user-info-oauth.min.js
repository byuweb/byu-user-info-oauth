const EVENT_PREFIX="byu-browser-oauth",EVENT_STATE_CHANGE=`${EVENT_PREFIX}-state-changed`,EVENT_LOGIN_REQUESTED=`${EVENT_PREFIX}-login-requested`,EVENT_LOGOUT_REQUESTED=`${EVENT_PREFIX}-logout-requested`,EVENT_CURRENT_INFO_REQUESTED=`${EVENT_PREFIX}-current-info-requested`,STATE_UNAUTHENTICATED="unauthenticated",STATE_AUTHENTICATED="authenticated";class AuthenticationObserver{constructor(e,{notifyCurrent:t=!0}={}){this._listener=function(t){e(t.detail)},document.addEventListener(EVENT_STATE_CHANGE,this._listener,!1),t&&dispatch(EVENT_CURRENT_INFO_REQUESTED,{callback:e})}disconnect(){document.removeEventListener(EVENT_STATE_CHANGE,this._listener,!1)}}async function login(){const e=promiseState([STATE_AUTHENTICATED]);return dispatch(EVENT_LOGIN_REQUESTED),e}async function logout(){const e=promiseState([STATE_UNAUTHENTICATED]);return dispatch(EVENT_LOGOUT_REQUESTED),e}function promiseState(e){return window.Promise?new Promise((t,n)=>{const s=new AuthenticationObserver(({state:o,token:r,user:E,error:i})=>{i?(n(i),s.offStateChange()):e.indexOf(o)>=0&&(t({state:o,token:r,user:E}),s.disconnect())})}):{then:()=>{},catch:()=>{},finally:()=>{}}}function dispatch(e,t){let n;"function"==typeof window.CustomEvent?n=new CustomEvent(e,{detail:t}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!1,t),document.dispatchEvent(n)}class ByuUserInfoOAuth extends HTMLElement{constructor(){super()}connectedCallback(){renderEmpty(this),this._observer=new AuthenticationObserver(e=>this.authStateChanged(e))}disconnectedCallback(){this._observer&&(this._observer.disconnect(),this._observer=null),this._userInfo=null}authStateChanged({state:e,token:t,user:n,error:s}){const o=this._userInfo.querySelector('[slot="user-name"]'),r=!!o;if(n){const e=r?o:this.ownerDocument.createElement("span");e.setAttribute("slot","user-name"),e.innerText=n.name.givenName,r||this._userInfo.appendChild(e)}else r&&this._userInfo.removeChild(o)}}function renderEmpty(e){const t=e.ownerDocument,n=t.createElement("byu-user-info");e._userInfo=n;const s=t.createElement("a");s.innerText="Sign In",s.setAttribute("slot","login"),s.addEventListener("click",()=>{login()});const o=t.createElement("a");o.innerText="Sign Out",o.setAttribute("slot","logout"),o.addEventListener("click",()=>{logout()}),n.appendChild(s),n.appendChild(o),e.appendChild(n)}window.customElements.define("byu-user-info-oauth",ByuUserInfoOAuth);export default ByuUserInfoOAuth;
//# sourceMappingURL=byu-user-info-oauth.min.js.map
